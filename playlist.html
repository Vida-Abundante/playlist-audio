function updateNowPlaying(src) {
  if (!src) {
    nowPlaying.textContent = "ðŸŽµ Reproduciendo: Nada";
    return;
  }

  // Normalizar para comparar nombres incluso con tildes o espacios
  const normalize = s => s.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();

  // Buscar en lista completa
  const idxFull = fullPlaylist.findIndex(url => normalize(url) === normalize(src));
  if (idxFull !== -1) {
    // Encontrar secciÃ³n y posiciÃ³n dentro de ella
    let sec = 0;
    let count = 0;
    for (let i = 0; i < sections.length; i++) {
      const len = sections[i].length;
      if (idxFull < count + len) {
        sec = i;
        const pos = idxFull - count + 1;
        const total = sections[sec].length;
        nowPlaying.textContent = `ðŸŽµ Reproduciendo: ${sectionNames[sec]}${total > 1 ? ` ${pos} de ${total}` : ""}`;
        return;
      }
      count += len;
    }
  }

  // Buscar en lista de secciÃ³n
  const listJson = player.dataset.list || "[]";
  try {
    const list = JSON.parse(listJson);
    const idx = list.findIndex(url => normalize(url) === normalize(src));
    if (idx !== -1 && player.dataset.mode === "section") {
      const secIdx = parseInt(player.dataset.section || 0);
      const total = list.length;
      nowPlaying.textContent = `ðŸŽµ Reproduciendo: ${sectionNames[secIdx]}${total > 1 ? ` ${idx + 1} de ${total}` : ""}`;
      return;
    }
  } catch (e) { /* sin errores visibles */ }

  // Si no encuentra coincidencias
  nowPlaying.textContent = "ðŸŽµ Reproduciendo";
}
