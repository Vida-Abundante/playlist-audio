<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mi Playlist</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }

    h2 {
      margin-bottom: 20px;
    }

    #mainPlayPause {
      font-size: 28px;
      padding: 25px 50px;
      border: none;
      border-radius: 15px;
      background-color: #28a745;
      color: white;
      cursor: pointer;
      margin-bottom: 30px;
      width: 80%;
      max-width: 400px;
    }

    #mainPlayPause:focus {
      outline: 3px solid yellow;
    }

    .player-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 10px;
    }

    audio {
      width: 70%;
      max-width: 400px;
    }

    .control-btn {
      font-size: 28px;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }

    .control-btn:focus {
      outline: 3px solid yellow;
    }

    .button-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      margin-top: 30px;
    }

    .track-btn {
      font-size: 24px;
      padding: 20px 40px;
      border: none;
      border-radius: 12px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
      width: 80%;
      max-width: 400px;
      transition: background-color 0.3s;
    }

    .track-btn.active {
      background-color: #0056b3;
    }

    .track-btn:focus {
      outline: 3px solid yellow;
    }

    #nowPlaying {
      font-size: 18px;
      color: #333;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h2>Reproductor de Audio</h2>

  <!-- Bot√≥n principal -->
  <button id="mainPlayPause" aria-label="Reproducir o pausar toda la lista">
    ‚ñ∂ Reproducir lista completa
  </button>

  <div class="player-container">
    <button class="control-btn" onclick="prevTrack()" aria-label="Pista anterior">‚èÆ</button>
    <audio id="player" controls></audio>
    <button class="control-btn" onclick="nextTrack()" aria-label="Siguiente pista">‚è≠</button>
  </div>

  <!-- Texto de pista actual -->
  <div id="nowPlaying">üéµ Reproduciendo: Nada</div>

  <div class="button-container">
    <button class="track-btn" id="btn0" onclick="playSection(0)">‚ñ∂ Salvaci√≥n</button>
    <button class="track-btn" id="btn1" onclick="playSection(1)">‚ñ∂ Pecado</button>
    <button class="track-btn" id="btn2" onclick="playSection(2)">‚ñ∂ La Palabra</button>
    <button class="track-btn" id="btn3" onclick="playSection(3)">‚ñ∂ La Oraci√≥n</button>
    <button class="track-btn" id="btn4" onclick="playSection(4)">‚ñ∂ Esp√≠ritu Santo</button>
    <button class="track-btn" id="btn5" onclick="playSection(5)">‚ñ∂ Bautismo</button>
    <button class="track-btn" id="btn6" onclick="playSection(6)">‚ñ∂ La Mayordom√≠a</button>
    <button class="track-btn" id="btn7" onclick="playSection(7)">‚ñ∂ Evangelismo</button>
    <button class="track-btn" id="btn8" onclick="playSection(8)">‚ñ∂ La Visi√≥n de la iglesia</button>
  </div>

  <script>
    const base = "https://caro1518-creator.github.io/playlist-audio/";

    const sections = [
      ["Salvaci√≥n.mp3"],
      ["Pecado.mp3"],
      ["La palabra 1.mp3", "La palabra 2.mp3", "La palabra 3.mp3"],
      ["La oraci√≥n 1.mp3", "La oraci√≥n 2.mp3", "La oraci√≥n 3.mp3", "La oraci√≥n 4.mp3", "La oraci√≥n 5.mp3"],
      ["Esp√≠ritu Santo 1.mp3", "Esp√≠ritu Santo 2.mp3", "Esp√≠ritu Santo 3.mp3"],
      ["Bautismo 1.mp3", "Bautismo 2.mp3"],
      ["Mayordom√≠a 1.mp3", "Mayordom√≠a 2.mp3"],
      ["Evangelismo.mp3"],
      ["Visi√≥n de la iglesia.mp3"]
    ];

    const sectionNames = ["Salvaci√≥n", "Pecado", "La Palabra", "La Oraci√≥n", "Esp√≠ritu Santo","Bautismo","Mayordom√≠a","Evangelismo","Visi√≥n de la iglesia"];

    // Lista completa (aplanada) y √≠ndices finales de cada secci√≥n (para saber cu√°ndo aplicar la pausa de 2s)
    const fullPlaylist = sections.flat().map(name => base + name);
    const sectionEndIndices = (function() {
      const ends = [];
      let idx = -1;
      for (let i = 0; i < sections.length; i++) {
        idx += sections[i].length;
        ends.push(idx);
      }
      return ends; // √≠ndices de √∫ltimo elemento por secci√≥n (0-based, respecto a fullPlaylist)
    })();

    const player = document.getElementById("player");
    const mainBtn = document.getElementById("mainPlayPause");
    const nowPlaying = document.getElementById("nowPlaying");
    const trackButtons = Array.from(document.getElementsByClassName("track-btn"));

    // Estado de control:
    // mode: "none" (nada iniciado), "full" (la lista completa fue iniciada), "section" (se est√° reproduciendo una secci√≥n)
    let mode = "none";
    // current index para fullPlaylist
    let fullIndex = 0;
    // waiting para evitar m√∫ltiples esperas
    let waiting = false;

    // Conectar evento principal al bot√≥n grande
    mainBtn.addEventListener("click", () => {
      if (mode === "none") {
        // iniciar lista completa
        startFullPlaylist();
      } else {
        // si estamos en modo 'full' o 'section' -> toggle play/pause de lo que est√© sonando ahora
        togglePlayPauseCurrent();
      }
    });

    // Funci√≥n: iniciar lista completa desde el lugar guardado (si est√° pausada) o desde el inicio
    function startFullPlaylist(resume = false) {
      mode = "full";
      if (!resume) fullIndex = 0;
      playFullAt(fullIndex);
      updateMainButton();
    }

    function playFullAt(index) {
      fullIndex = index;
      playTrackFromList(fullPlaylist, fullIndex);
      // indicar que el player est√° usando la lista completa (gu√°rdalo en dataset para prev/next)
      player.dataset.mode = "full";
      player.dataset.index = fullIndex;
      updateMainButton();
    }

    // Funci√≥n: reproducir una secci√≥n (bot√≥n individual)
    function playSection(sectionIdx) {
      // Si el usuario hizo click en la misma secci√≥n que ya est√° cargada:
      const list = sections[sectionIdx].map(n => base + n);
      const currentSrc = player.src;
      const isSameSection = (player.dataset.mode === "section" && player.dataset.section == sectionIdx);
      const isPlaying = !player.paused;

      if (isSameSection) {
        // toggle play/pause
        if (isPlaying) player.pause();
        else player.play();
        updateMainButton();
        return;
      }

      // Si es una nueva secci√≥n a reproducir
      mode = "section";
      player.dataset.mode = "section";
      player.dataset.section = sectionIdx;
      playTrackFromList(list, 0);
      updateButtonStates();
      updateMainButton();
    }

    // Reproduce una lista arbitraria (se usa para secciones)
    function playTrackFromList(list, index) {
      player.src = list[index];
      player.play().catch(() => {/* autoplay bloqueado por navegador, el usuario deber√° tocar reproducir */});
      player.dataset.list = JSON.stringify(list);
      player.dataset.index = index;
      updateNowPlaying(player.src);
    }

    // Prev / Next: funcionan sobre la lista actual (full o section)
    function nextTrack() {
      const currentMode = player.dataset.mode || (mode === "full" ? "full" : "section");
      if (currentMode === "full") {
        // si estamos en full, avanzar fullIndex (con pausa entre secciones cuando corresponde)
        if (fullIndex < fullPlaylist.length - 1) {
          // si el siguiente es el comienzo de una nueva secci√≥n y el actual es final de secci√≥n, esperar 2s
          const isEndOfSection = sectionEndIndices.includes(fullIndex);
          if (isEndOfSection) {
            waitAndPlayFull(fullIndex + 1);
          } else {
            playFullAt(fullIndex + 1);
          }
        } else {
          // fin de lista completa
          finishFullPlaylist();
        }
      } else {
        // lista actual (section)
        const list = JSON.parse(player.dataset.list || "[]");
        let i = parseInt(player.dataset.index || 0);
        if (i + 1 < list.length) {
          playTrackFromList(list, i + 1);
        } else {
          // fin de la secci√≥n: dejamos en pausa y limpiamos estado de secci√≥n (no cambiar a full)
          player.pause();
          updateNowPlaying("");
          mode = "none";
          player.dataset.mode = "";
          updateButtonStates();
          updateMainButton();
        }
      }
    }

    function prevTrack() {
      const currentMode = player.dataset.mode || (mode === "full" ? "full" : "section");
      if (currentMode === "full") {
        if (fullIndex > 0) playFullAt(fullIndex - 1);
      } else {
        const list = JSON.parse(player.dataset.list || "[]");
        let i = parseInt(player.dataset.index || 0);
        if (i > 0) playTrackFromList(list, i - 1);
      }
    }

    // Espera 2s (si no hay ya una espera en curso) y luego reproduce el √≠ndice dado en fullPlaylist
    async function waitAndPlayFull(nextIdx) {
      if (waiting) return;
      waiting = true;
      updateNowPlaying("‚è∏ Esperando 2s antes de la siguiente secci√≥n...");
      await new Promise(r => setTimeout(r, 2000));
      waiting = false;
      playFullAt(nextIdx);
    }

    // Play/pause toggle para lo que est√© corriendo ahora (usado por el bot√≥n principal cuando no estaba en modo 'none')
    function togglePlayPauseCurrent() {
      if (!player.src) {
        // si no hay src cargado, iniciar lista completa
        startFullPlaylist();
        return;
      }
      if (player.paused) {
        player.play();
      } else {
        player.pause();
      }
      updateMainButton();
    }

    // Al finalizar una pista, manejamos la transici√≥n
    player.addEventListener("ended", () => {
      const currentMode = player.dataset.mode || (mode === "full" ? "full" : "section");
      if (currentMode === "full") {
        // Si el √≠ndice actual es el final de la lista => terminar; si es final de secci√≥n => esperar 2s y continuar, si no => continuar
        const idx = fullIndex;
        if (idx >= fullPlaylist.length - 1) {
          finishFullPlaylist();
        } else {
          // Si el track que termin√≥ era el final de una secci√≥n => espera 2s
          const isEndOfSection = sectionEndIndices.includes(idx);
          if (isEndOfSection) {
            waitAndPlayFull(idx + 1);
          } else {
            playFullAt(idx + 1);
          }
        }
      } else {
        // secci√≥n: avanzar dentro de la secci√≥n si hay m√°s
        const list = JSON.parse(player.dataset.list || "[]");
        let i = parseInt(player.dataset.index || 0);
        if (i + 1 < list.length) {
          playTrackFromList(list, i + 1);
        } else {
          // secci√≥n terminada
          mode = "none";
          player.dataset.mode = "";
          updateNowPlaying("");
          updateButtonStates();
          updateMainButton();
        }
      }
    });

    // Al play/pause actualizamos estado de botones/textos
    player.addEventListener("play", () => {
      // si estamos en full y player.src coincide con un elemento en fullPlaylist -> ajustar fullIndex
      if (player.dataset.mode === "full") {
        const idx = fullPlaylist.indexOf(player.src);
        if (idx !== -1) fullIndex = idx;
      }
      updateButtonStates();
      updateMainButton();
      updateNowPlaying(player.src);
    });
    player.addEventListener("pause", () => {
      updateButtonStates();
      updateMainButton();
      if (!player.src) updateNowPlaying("");
    });

    // Reproduce en la lista completa en index dado
    function playFullListFrom(index) {
      mode = "full";
      player.dataset.mode = "full";
      playFullAt(index);
    }

    // Funci√≥n para terminar la lista completa
    function finishFullPlaylist() {
      mode = "none";
      player.dataset.mode = "";
      player.pause();
      updateMainButton();
      updateButtonStates();
      updateNowPlaying("");
    }

    // Actualizar el texto del bot√≥n principal seg√∫n modo y estado
    function updateMainButton() {
      if (mode === "none") {
        mainBtn.textContent = "‚ñ∂ Reproducir lista completa";
      } else if (mode === "full") {
        mainBtn.textContent = player.paused ? "‚ñ∂ Reanudar lista completa" : "‚è∏ Pausar lista completa";
      } else if (mode === "section") {
        mainBtn.textContent = player.paused ? "‚ñ∂ Reanudar" : "‚è∏ Pausar";
      }
    }

// Muestra en pantalla qu√© se est√° reproduciendo
function updateNowPlaying(src) {
  if (!src) {
    nowPlaying.textContent = "üéµ Reproduciendo: Nada";
    return;
  }

  // Limpiar par√°metros innecesarios (a veces el navegador agrega ?v=...)
  const cleanSrc = decodeURIComponent(src.split("?")[0]);

  // Buscar en fullPlaylist
  for (let s = 0, index = 0; s < sections.length; s++) {
    const section = sections[s];
    for (let i = 0; i < section.length; i++, index++) {
      const expectedSrc = base + section[i];
      if (cleanSrc.endsWith(section[i])) {
        const label = sectionNames[s];
        const pos = section.length > 1 ? ` (${i + 1} de ${section.length})` : "";
        nowPlaying.textContent = `üéµ Reproduciendo: ${label}${pos}`;
        return;
      }
    }
  }

  nowPlaying.textContent = "üéµ Reproduciendo";
}


    // Actualizar clases y texto de botones de secci√≥n
    function updateButtonStates() {
      trackButtons.forEach((btn, i) => {
        const label = sectionNames[i];
        const isActive = (player.dataset.mode === "section" && parseInt(player.dataset.section || -1) === i && !player.paused);
        if (isActive) {
          btn.textContent = "‚è∏ " + label;
          btn.classList.add("active");
        } else {
          btn.textContent = "‚ñ∂ " + label;
          btn.classList.remove("active");
        }
      });
    }

    // Inicializar: cargar el primer audio (opcional)
    player.src = base + sections[0][0];
    player.dataset.mode = ""; // inicialmente vac√≠o
    updateMainButton();
    updateButtonStates();
  </script>
</body>
</html>




