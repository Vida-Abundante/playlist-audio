<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mi Playlist ‚Äì Vida Abundante</title>

  <!-- Vista previa para WhatsApp / redes -->
  <meta property="og:title" content="Mi Playlist ‚Äì Vida Abundante" />
  <meta property="og:description" content="Escuch√° los audios de ense√±anza de la Iglesia Cristiana de la Vida Abundante üíñ" />
  <meta property="og:image" content="https://vida-abundante.github.io/playlist-audio/PortadaCuadrada.jpeg" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://vida-abundante.github.io/playlist-audio/" />

  <!-- Archivos PWA -->
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="PortadaCuadrada.png" />
  <meta name="theme-color" content="#fffafc" />

  <style>
    body {
      font-family: "Poppins", sans-serif;
      background-color: #fffafc;
      color: #3a2a2a;
      text-align: center;
      padding: 20px;
      margin: 0;
    }

    .hidden {
      display: none;
    }

    h1 {
      margin-top: 0.5rem;
      color: #3a2a2a;
    }

    h2 {
      margin-bottom: 15px;
    }

    .btn-navegador {
      display: inline-block;
      background-color: #83bde3;
      color: white;
      border: none;
      border-radius: 10px;
      padding: 12px 20px;
      font-size: 1em;
      cursor: pointer;
      margin-bottom: 20px;
    }

    .btn-navegador:hover {
      opacity: 0.9;
    }

    video {
      width: 220px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      margin: 1rem auto;
      display: block;
    }

    #instruccion {
      display: none;
      margin-top: 1.5rem;
      font-size: 1rem;
      color: #222;
    }

    #instruccion h4 {
      margin: 0.8rem 0;
      line-height: 1.5;
    }

    #instruccion video, 
    #instruccion img {
      width: 90%;
      max-width: 320px;
      border-radius: 12px;
      margin-top: 1rem;
      box-shadow: 0 0 12px rgba(0,0,0,0.1);
    }

    #main {
      max-width: 500px;
      margin: 0 auto;
    }

    /* üéß Estilos del reproductor */
    #mainPlayPause {
      font-size: 28px;
      padding: 25px 50px;
      border: none;
      border-radius: 15px;
      background-color: #28a745;
      color: white;
      cursor: pointer;
      margin-bottom: 30px;
      width: 80%;
      max-width: 400px;
    }

    .player-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 10px;
    }

    audio {
      width: 70%;
      max-width: 400px;
    }

    .control-btn {
      font-size: 28px;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }

    .button-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      margin-top: 30px;
    }

    .track-btn {
      font-size: 24px;
      padding: 20px 40px;
      border: none;
      border-radius: 12px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
      width: 80%;
      max-width: 400px;
      transition: background-color 0.3s;
    }

    .track-btn.active {
      background-color: #0056b3;
    }

    #nowPlaying {
      font-size: 18px;
      color: #333;
      margin-top: 10px;
    }

    /* Loader */
    #loader {
      display: flex;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: #fffafc;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 999;
      font-size: 1.2rem;
    }
  </style>
</head>

<body class="hidden">
  <button class="btn-navegador" onclick="mostrarInstruccion()">üì± Ver como aplicaci√≥n</button>

  <div id="main">
    <h1>Mi Playlist ‚Äì Vida Abundante</h1>
    <h2>Reproductor de Audio</h2>

    <button id="mainPlayPause">‚ñ∂ Reproducir lista completa</button>

    <div class="player-container">
      <button class="control-btn" onclick="prevTrack()">‚èÆ</button>
      <audio id="player" controls></audio>
      <button class="control-btn" onclick="nextTrack()">‚è≠</button>
    </div>

    <div id="nowPlaying">üéµ Reproduciendo: Nada</div>

    <div class="button-container">
      <button class="track-btn" id="btn0" onclick="playSection(0)">‚ñ∂ Salvaci√≥n</button>
      <button class="track-btn" id="btn1" onclick="playSection(1)">‚ñ∂ Pecado</button>
      <button class="track-btn" id="btn2" onclick="playSection(2)">‚ñ∂ La Palabra</button>
      <button class="track-btn" id="btn3" onclick="playSection(3)">‚ñ∂ La Oraci√≥n</button>
      <button class="track-btn" id="btn4" onclick="playSection(4)">‚ñ∂ Esp√≠ritu Santo</button>
      <button class="track-btn" id="btn5" onclick="playSection(5)">‚ñ∂ Bautismo</button>
      <button class="track-btn" id="btn6" onclick="playSection(6)">‚ñ∂ Mayordom√≠a</button>
      <button class="track-btn" id="btn7" onclick="playSection(7)">‚ñ∂ Evangelismo</button>
      <button class="track-btn" id="btn8" onclick="playSection(8)">‚ñ∂ Visi√≥n de la iglesia</button>
    </div>
  </div>

  <!-- Instrucciones de instalaci√≥n -->
  <div id="instruccion">
    <h4>üì≤ Para usarla como app:</h4>
    <h4>Abre el men√∫ del navegador ‚Üí <b>‚ãÆ</b> y eleg√≠ <b>‚ÄúAgregar a pantalla de inicio‚Äù</b>.</h4>
   <video src="InstruccionInstalar.mp4" controls autoplay muted loop></video>
    <h4>As√≠ podr√°s abrirla desde tu pantalla como una aplicaci√≥n üíñ</h4>
  </div>

  <div id="loader"><p>Abriendo...</p></div>

  <!-- Script de instalaci√≥n -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {     
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('service-worker.js');
      }

  

      const esAppInstalada =
        window.matchMedia('(display-mode: standalone)').matches ||
        window.navigator.standalone === true;

      const loader = document.getElementById("loader");
      const body = document.body;

      // Ocultamos el loader y mostramos el contenido directamente
      loader.style.display = "none";
      body.classList.remove("hidden");

// Buscar el bot√≥n "Ver como aplicaci√≥n" y ocultarlo si la app est√° instalada
const btnAplicacion = document.querySelector(".btn-navegador");
if (esAppInstalada) {
  btnAplicacion.style.display = "none";
}
      
      // Mostrar las instrucciones
      window.mostrarInstruccion = () => {
        document.getElementById("main").style.display = "none";
        document.getElementById("instruccion").style.display = "block";
      };
    });
  </script>

  <!-- üéß Script del reproductor -->
  <script>
    const base = "https://vida-abundante.github.io/playlist-audio/";

    const sections = [
      ["Salvaci√≥n.mp3"],
      ["Pecado.mp3"],
      ["La palabra 1.mp3", "La palabra 2.mp3", "La palabra 3.mp3"],
      ["La oraci√≥n 1.mp3", "La oraci√≥n 2.mp3", "La oraci√≥n 3.mp3", "La oraci√≥n 4.mp3", "La oraci√≥n 5.mp3"],
      ["Esp√≠ritu Santo 1.mp3", "Esp√≠ritu Santo 2.mp3", "Esp√≠ritu Santo 3.mp3"],
      ["Bautismo 1.mp3", "Bautismo 2.mp3"],
      ["Mayordom√≠a 1.mp3", "Mayordom√≠a 2.mp3"],
      ["Evangelismo.mp3"],
      ["Visi√≥n de la iglesia.mp3"]
    ];

    const sectionNames = ["Salvaci√≥n", "Pecado", "La Palabra", "La Oraci√≥n", "Esp√≠ritu Santo", "Bautismo", "Mayordom√≠a", "Evangelismo", "Visi√≥n de la iglesia"];

    const fullPlaylist = sections.flat().map(name => base + name);

    const sectionEndIndices = (() => {
      const ends = [];
      let idx = -1;
      for (let i = 0; i < sections.length; i++) {
        idx += sections[i].length;
        ends.push(idx);
      }
      return ends;
    })();

    const player = document.getElementById("player");
    const mainBtn = document.getElementById("mainPlayPause");
    const nowPlaying = document.getElementById("nowPlaying");
    const trackButtons = Array.from(document.getElementsByClassName("track-btn"));

    let mode = "none";
    let fullIndex = 0;
    let waiting = false;

    mainBtn.addEventListener("click", () => {
      if (mode === "none") {
        startFullPlaylist();
      } else {
        togglePlayPauseCurrent();
      }
    });

    function startFullPlaylist(resume = false) {
      mode = "full";
      if (!resume) fullIndex = 0;
      playFullAt(fullIndex);
      updateMainButton();
    }

    function playFullAt(index) {
      fullIndex = index;
      playTrackFromList(fullPlaylist, fullIndex);
      player.dataset.mode = "full";
      player.dataset.index = fullIndex;
      updateMainButton();
    }

    function playSection(sectionIdx) {
      const list = sections[sectionIdx].map(n => base + n);
      const currentSrc = player.src;
      const isSameSection = (player.dataset.mode === "section" && player.dataset.section == sectionIdx);
      const isPlaying = !player.paused;

      if (isSameSection) {
        if (isPlaying) player.pause(); else player.play();
        updateMainButton();
        return;
      }

      mode = "section";
      player.dataset.mode = "section";
      player.dataset.section = sectionIdx;
      playTrackFromList(list, 0);
      updateButtonStates();
      updateMainButton();
    }

    function playTrackFromList(list, index) {
      player.src = list[index];
      player.play().catch(() => {});
      player.dataset.list = JSON.stringify(list);
      player.dataset.index = index;
      updateNowPlaying(player.src);
    }

    function nextTrack() {
      const currentMode = player.dataset.mode || (mode === "full" ? "full" : "section");
      if (currentMode === "full") {
        if (fullIndex < fullPlaylist.length - 1) {
          const isEndOfSection = sectionEndIndices.includes(fullIndex);
          if (isEndOfSection) waitAndPlayFull(fullIndex + 1);
          else playFullAt(fullIndex + 1);
        } else finishFullPlaylist();
      } else {
        const list = JSON.parse(player.dataset.list || "[]");
        let i = parseInt(player.dataset.index || 0);
        if (i + 1 < list.length) playTrackFromList(list, i + 1);
        else finishSection();
      }
    }

    function prevTrack() {
      const currentMode = player.dataset.mode || (mode === "full" ? "full" : "section");
      if (currentMode === "full") {
        if (fullIndex > 0) playFullAt(fullIndex - 1);
      } else {
        const list = JSON.parse(player.dataset.list || "[]");
        let i = parseInt(player.dataset.index || 0);
        if (i > 0) playTrackFromList(list, i - 1);
      }
    }

    async function waitAndPlayFull(nextIdx) {
      if (waiting) return;
      waiting = true;
      updateNowPlaying("‚è∏ Esperando 2s...");
      await new Promise(r => setTimeout(r, 2000));
      waiting = false;
      playFullAt(nextIdx);
    }

    function togglePlayPauseCurrent() {
      if (!player.src) { startFullPlaylist(); return; }
      if (player.paused) player.play(); else player.pause();
      updateMainButton();
    }

    player.addEventListener("ended", () => {
      const currentMode = player.dataset.mode || (mode === "full" ? "full" : "section");
      if (currentMode === "full") {
        const idx = fullIndex;
        if (idx >= fullPlaylist.length - 1) finishFullPlaylist();
        else {
          const isEndOfSection = sectionEndIndices.includes(idx);
          if (isEndOfSection) waitAndPlayFull(idx + 1);
          else playFullAt(idx + 1);
        }
      } else {
        const list = JSON.parse(player.dataset.list || "[]");
        let i = parseInt(player.dataset.index || 0);
        if (i + 1 < list.length) playTrackFromList(list, i + 1);
        else finishSection();
      }
    });

    player.addEventListener("play", () => { updateButtonStates(); updateMainButton(); updateNowPlaying(player.src); });
   player.addEventListener("pause", () => {
  updateButtonStates();
  updateMainButton();
  guardarProgreso();
});

    function finishFullPlaylist() {
      mode = "none";
      player.pause();
      updateMainButton();
      updateButtonStates();
      updateNowPlaying("");
    }

    function finishSection() {
      mode = "none";
      player.pause();
      player.dataset.mode = "";
      updateNowPlaying("");
      updateButtonStates();
      updateMainButton();
    }

    function updateMainButton() {
      if (mode === "none") mainBtn.textContent = "‚ñ∂ Reproducir lista completa";
      else if (mode === "full") mainBtn.textContent = player.paused ? "‚ñ∂ Reanudar lista completa" : "‚è∏ Pausar lista completa";
      else if (mode === "section") mainBtn.textContent = player.paused ? "‚ñ∂ Reanudar" : "‚è∏ Pausar";
    }

    function updateNowPlaying(src) {
      if (!src) { nowPlaying.textContent = "üéµ Reproduciendo: Nada"; return; }
      const cleanSrc = decodeURIComponent(src.split("?")[0]);
      for (let s = 0; s < sections.length; s++) {
        const section = sections[s];
        for (let i = 0; i < section.length; i++) {
          if (cleanSrc.endsWith(section[i])) {
            const label = sectionNames[s];
            const pos = section.length > 1 ? ` (${i + 1} de ${section.length})` : "";
            nowPlaying.textContent = `üéµ Reproduciendo: ${label}${pos}`;
            return;
          }
        }
      }
      nowPlaying.textContent = "üéµ Reproduciendo";
    }

    function updateButtonStates() {
      trackButtons.forEach((btn, i) => {
        const label = sectionNames[i];
        const isActive = (player.dataset.mode === "section" && parseInt(player.dataset.section || -1) === i && !player.paused);
        btn.textContent = (isActive ? "‚è∏ " : "‚ñ∂ ") + label;
        btn.classList.toggle("active", isActive);
      });
    }

function guardarProgreso() {
  const modo = player.dataset.mode || mode;
  const index = player.dataset.index || 0;
  const time = player.currentTime || 0;
  const section = player.dataset.section || null;

  localStorage.setItem("modoReproduccion", modo);
  localStorage.setItem("indiceActual", index);
  localStorage.setItem("tiempoActual", time);
  localStorage.setItem("seccionActual", section);
}
</script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const modoGuardado = localStorage.getItem("modoReproduccion");
    const indexGuardado = parseInt(localStorage.getItem("indiceActual") || 0);
    const tiempoGuardado = parseFloat(localStorage.getItem("tiempoActual") || 0);
    const seccionGuardada = parseInt(localStorage.getItem("seccionActual"));

    if (modoGuardado === "full") {
      mode = "full";
      playFullAt(indexGuardado);
      player.currentTime = tiempoGuardado;
    } else if (modoGuardado === "section" && !isNaN(seccionGuardada)) {
      mode = "section";
      const list = sections[seccionGuardada].map(n => base + n);
      playTrackFromList(list, indexGuardado);
      player.dataset.mode = "section";
      player.dataset.section = seccionGuardada;
      player.currentTime = tiempoGuardado;
    }

    updateMainButton();
    updateButtonStates();
  });
</script>

<script>
  // Guardado autom√°tico del progreso cada 10 segundos
  setInterval(() => {
    if (!player.paused && player.src) {
      guardarProgreso();
    }
  }, 10000); // cada 10 segundos
</script>

  
</body>
</html>




